{"ast":null,"code":"import _slicedToArray from\"/Users/BrienOShane93/Documents/GitHub/react-intro/hurleymaker-assignment2/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useCallback,useEffect}from\"react\";import{Container}from\"semantic-ui-react\";import{Route,useHistory,Switch}from\"react-router-dom\";import\"./Layout.css\";import Nav from\"../Nav/Nav\";import HurleyMaker from\"../../containers/HurleyMaker/HurleyMaker\";import YourOrders from\"../../containers/YourOrders/YourOrders\";import PlaceOrder from\"../../containers/PlaceOrder/PlaceOrder\";import OrderSuccess from\"../../containers/PlaceOrder/OrderSuccess/OrderSuccess\";import Authenticate from\"../../containers/Authenticate/Authenticate\";import YourAccount from\"../../containers/YourAccount/YourAccount\";import AccountUpdate from\"../../containers/YourAccount/AccountUpdate/AccountUpdate\";import AuthContext from\"../../context/auth-context\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var logoutTimer;var Layout=function Layout(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),token=_useState2[0],setToken=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),userId=_useState4[0],setUserId=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),tokenExpirationDate=_useState6[0],setTokenExpirationDate=_useState6[1];var history=useHistory();var login=useCallback(function(uid,token,expirationDate){setToken(token);setUserId(uid);var tokenExpirationDate=expirationDate||new Date(new Date().getTime()+1000*60*60);setTokenExpirationDate(tokenExpirationDate);localStorage.setItem(\"userData\",JSON.stringify({userId:uid,token:token,expiration:tokenExpirationDate.toISOString()}));},[]);var logout=useCallback(function(){setToken(null);setTokenExpirationDate(null);setUserId(null);localStorage.removeItem(\"userData\");history.push(\"/\");},[]);useEffect(function(){var storedData=JSON.parse(localStorage.getItem(\"userData\"));if(storedData&&storedData.token&&new Date(storedData.expiration)>new Date()){login(storedData.userId,storedData.token,new Date(storedData.expiration));}},[login]);useEffect(function(){if(token&&tokenExpirationDate){var remainingTime=tokenExpirationDate.getTime()-new Date().getTime();logoutTimer=setTimeout(logout,remainingTime);}else{clearTimeout(logoutTimer);}},[token,logout,tokenExpirationDate]);var routes;if(token){routes=/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(Route,{path:\"/\",exact:true,component:HurleyMaker}),/*#__PURE__*/_jsx(Route,{path:\"/orders/:uid\",component:YourOrders}),/*#__PURE__*/_jsx(Route,{path:\"/place-order\",component:PlaceOrder}),/*#__PURE__*/_jsx(Route,{path:\"/order-success\",component:OrderSuccess}),/*#__PURE__*/_jsx(Route,{path:\"/users/:uid\",component:YourAccount}),/*#__PURE__*/_jsx(Route,{path:\"/update-account\",component:AccountUpdate})]});}else{routes=/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(Route,{path:\"/\",exact:true,component:HurleyMaker}),/*#__PURE__*/_jsx(Route,{path:\"/authenticate\",component:Authenticate})]});}return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{isLoggedIn:!!token,token:token,userId:userId,login:login,logout:logout},children:/*#__PURE__*/_jsxs(Container,{children:[/*#__PURE__*/_jsx(Nav,{}),routes]})});};export default Layout;","map":{"version":3,"sources":["/Users/BrienOShane93/Documents/GitHub/react-intro/hurleymaker-assignment2/frontend/src/components/Layout/Layout.js"],"names":["React","useState","useCallback","useEffect","Container","Route","useHistory","Switch","Nav","HurleyMaker","YourOrders","PlaceOrder","OrderSuccess","Authenticate","YourAccount","AccountUpdate","AuthContext","logoutTimer","Layout","props","token","setToken","userId","setUserId","tokenExpirationDate","setTokenExpirationDate","history","login","uid","expirationDate","Date","getTime","localStorage","setItem","JSON","stringify","expiration","toISOString","logout","removeItem","push","storedData","parse","getItem","remainingTime","setTimeout","clearTimeout","routes","isLoggedIn"],"mappings":"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","sourcesContent":["import React, { useState, useCallback, useEffect } from \"react\";\r\nimport { Container } from \"semantic-ui-react\";\r\nimport { Route, useHistory, Switch } from \"react-router-dom\";\r\n\r\nimport \"./Layout.css\";\r\n\r\nimport Nav from \"../Nav/Nav\";\r\nimport HurleyMaker from \"../../containers/HurleyMaker/HurleyMaker\";\r\nimport YourOrders from \"../../containers/YourOrders/YourOrders\";\r\nimport PlaceOrder from \"../../containers/PlaceOrder/PlaceOrder\";\r\nimport OrderSuccess from \"../../containers/PlaceOrder/OrderSuccess/OrderSuccess\";\r\nimport Authenticate from \"../../containers/Authenticate/Authenticate\";\r\nimport YourAccount from \"../../containers/YourAccount/YourAccount\";\r\nimport AccountUpdate from \"../../containers/YourAccount/AccountUpdate/AccountUpdate\";\r\nimport AuthContext from \"../../context/auth-context\";\r\n\r\nlet logoutTimer;\r\n\r\nconst Layout = (props) => {\r\n\r\n  const [token, setToken] = useState(false);\r\n  const [userId, setUserId] = useState(false);\r\n  const [tokenExpirationDate, setTokenExpirationDate] = useState();\r\n\r\n  const history = useHistory();\r\n\r\n  const login = useCallback((uid, token, expirationDate) => {\r\n    setToken(token);\r\n    setUserId(uid);\r\n    const tokenExpirationDate = expirationDate || new Date(new Date().getTime() + 1000 * 60 * 60);\r\n    setTokenExpirationDate(tokenExpirationDate);\r\n    localStorage.setItem(\r\n      \"userData\",\r\n      JSON.stringify({\r\n        userId: uid,\r\n        token: token,\r\n        expiration: tokenExpirationDate.toISOString()\r\n      })\r\n    );\r\n  }, []);\r\n\r\n  const logout = useCallback(() => {\r\n    setToken(null);\r\n    setTokenExpirationDate(null);\r\n    setUserId(null);\r\n    localStorage.removeItem(\"userData\");\r\n    history.push(\"/\");\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const storedData = JSON.parse(localStorage.getItem(\"userData\"));\r\n    if ( storedData && storedData.token && new Date(storedData.expiration) > new Date() ) {\r\n      login(storedData.userId, storedData.token, new Date(storedData.expiration));\r\n    }\r\n  }, [login]);\r\n\r\n  useEffect(() => {\r\n    if (token && tokenExpirationDate) {\r\n      const remainingTime = tokenExpirationDate.getTime() - new Date().getTime();\r\n      logoutTimer = setTimeout(logout, remainingTime);\r\n    } else {\r\n      clearTimeout(logoutTimer);\r\n    }\r\n  }, [token, logout, tokenExpirationDate]);\r\n\r\n  let routes;\r\n  if (token) {\r\n    routes = (\r\n      <Switch>\r\n        <Route path=\"/\" exact component={HurleyMaker} />\r\n        <Route path=\"/orders/:uid\" component={YourOrders} />\r\n        <Route path=\"/place-order\" component={PlaceOrder} />\r\n        <Route path=\"/order-success\" component={OrderSuccess} />\r\n        <Route path=\"/users/:uid\" component={YourAccount} />\r\n        <Route path=\"/update-account\" component={AccountUpdate} />\r\n      </Switch>\r\n    );\r\n  } else {\r\n    routes = (\r\n      <Switch>\r\n        <Route path=\"/\" exact component={HurleyMaker} />\r\n        <Route path=\"/authenticate\" component={Authenticate} />\r\n      </Switch>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value = {{\r\n        isLoggedIn: !!token,\r\n        token: token,\r\n        userId: userId,\r\n        login: login,\r\n        logout: logout\r\n      }}\r\n    >\r\n      <Container>\r\n        <Nav />\r\n        {routes}\r\n      </Container>\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport default Layout;\r\n"]},"metadata":{},"sourceType":"module"}