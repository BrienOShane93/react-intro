{"ast":null,"code":"import _slicedToArray from\"/Users/BrienOShane93/Documents/GitHub/react-intro/hurleymaker-assignment2/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useCallback,useEffect,Suspense}from\"react\";import Loader from'../Feedback/Loader/Loader';import{Container}from\"semantic-ui-react\";import{Route,useHistory,Switch}from\"react-router-dom\";import\"./Layout.css\";import Nav from\"../Nav/Nav\";import HurleyMaker from\"../../containers/HurleyMaker/HurleyMaker\";import AuthContext from\"../../context/auth-context\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var YourOrders=/*#__PURE__*/React.lazy(function(){return import(\"../../containers/YourOrders/YourOrders\");});var PlaceOrder=/*#__PURE__*/React.lazy(function(){return import(\"../../containers/PlaceOrder/PlaceOrder\");});var OrderSuccess=/*#__PURE__*/React.lazy(function(){return import(\"../../containers/PlaceOrder/OrderSuccess/OrderSuccess\");});var Authenticate=/*#__PURE__*/React.lazy(function(){return import(\"../../containers/Authenticate/Authenticate\");});var YourAccount=/*#__PURE__*/React.lazy(function(){return import(\"../../containers/YourAccount/YourAccount\");});var AccountUpdate=/*#__PURE__*/React.lazy(function(){return import(\"../../containers/YourAccount/AccountUpdate/AccountUpdate\");});var logoutTimer;var Layout=function Layout(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),token=_useState2[0],setToken=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),userId=_useState4[0],setUserId=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),tokenExpirationDate=_useState6[0],setTokenExpirationDate=_useState6[1];var history=useHistory();var login=useCallback(function(uid,token,expirationDate){setToken(token);setUserId(uid);var tokenExpirationDate=expirationDate||new Date(new Date().getTime()+1000*60*60);setTokenExpirationDate(tokenExpirationDate);localStorage.setItem(\"userData\",JSON.stringify({userId:uid,token:token,expiration:tokenExpirationDate.toISOString()}));},[]);var logout=useCallback(function(){setToken(null);setTokenExpirationDate(null);setUserId(null);localStorage.removeItem(\"userData\");history.push(\"/\");},[]);useEffect(function(){var storedData=JSON.parse(localStorage.getItem(\"userData\"));if(storedData&&storedData.token&&new Date(storedData.expiration)>new Date()){login(storedData.userId,storedData.token,new Date(storedData.expiration));}},[login]);useEffect(function(){if(token&&tokenExpirationDate){var remainingTime=tokenExpirationDate.getTime()-new Date().getTime();logoutTimer=setTimeout(logout,remainingTime);}else{clearTimeout(logoutTimer);}},[token,logout,tokenExpirationDate]);var routes;if(token){routes=/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(Route,{path:\"/\",exact:true,component:HurleyMaker}),/*#__PURE__*/_jsx(Route,{path:\"/orders/:uid\",component:YourOrders}),/*#__PURE__*/_jsx(Route,{path:\"/place-order\",component:PlaceOrder}),/*#__PURE__*/_jsx(Route,{path:\"/order-success\",component:OrderSuccess}),/*#__PURE__*/_jsx(Route,{path:\"/users/:uid\",component:YourAccount}),/*#__PURE__*/_jsx(Route,{path:\"/update-account\",component:AccountUpdate})]});}else{routes=/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(Route,{path:\"/\",exact:true,component:HurleyMaker}),/*#__PURE__*/_jsx(Route,{path:\"/authenticate\",component:Authenticate})]});}return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{isLoggedIn:!!token,token:token,userId:userId,login:login,logout:logout},children:/*#__PURE__*/_jsxs(Container,{children:[/*#__PURE__*/_jsx(Nav,{}),/*#__PURE__*/_jsx(Suspense,{fallback:/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Loader,{active:\"true\"})}),children:routes})]})});};export default Layout;","map":{"version":3,"sources":["/Users/BrienOShane93/Documents/GitHub/react-intro/hurleymaker-assignment2/frontend/src/components/Layout/Layout.js"],"names":["React","useState","useCallback","useEffect","Suspense","Loader","Container","Route","useHistory","Switch","Nav","HurleyMaker","AuthContext","YourOrders","lazy","PlaceOrder","OrderSuccess","Authenticate","YourAccount","AccountUpdate","logoutTimer","Layout","props","token","setToken","userId","setUserId","tokenExpirationDate","setTokenExpirationDate","history","login","uid","expirationDate","Date","getTime","localStorage","setItem","JSON","stringify","expiration","toISOString","logout","removeItem","push","storedData","parse","getItem","remainingTime","setTimeout","clearTimeout","routes","isLoggedIn"],"mappings":"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","sourcesContent":["import React, { useState, useCallback, useEffect, Suspense } from \"react\";\r\nimport Loader from '../Feedback/Loader/Loader';\r\nimport { Container } from \"semantic-ui-react\";\r\nimport { Route, useHistory, Switch } from \"react-router-dom\";\r\n\r\nimport \"./Layout.css\";\r\n\r\nimport Nav from \"../Nav/Nav\";\r\nimport HurleyMaker from \"../../containers/HurleyMaker/HurleyMaker\";\r\nimport AuthContext from \"../../context/auth-context\";\r\n\r\nconst YourOrders = React.lazy(() => import(\"../../containers/YourOrders/YourOrders\"));\r\nconst PlaceOrder = React.lazy(() => import(\"../../containers/PlaceOrder/PlaceOrder\"));\r\nconst OrderSuccess = React.lazy(() => import(\"../../containers/PlaceOrder/OrderSuccess/OrderSuccess\"));\r\nconst Authenticate = React.lazy(() => import(\"../../containers/Authenticate/Authenticate\"));\r\nconst YourAccount = React.lazy(() => import(\"../../containers/YourAccount/YourAccount\"));\r\nconst AccountUpdate = React.lazy(() => import(\"../../containers/YourAccount/AccountUpdate/AccountUpdate\"));\r\n\r\nlet logoutTimer;\r\n\r\nconst Layout = (props) => {\r\n\r\n  const [token, setToken] = useState(false);\r\n  const [userId, setUserId] = useState(false);\r\n  const [tokenExpirationDate, setTokenExpirationDate] = useState();\r\n\r\n  const history = useHistory();\r\n\r\n  const login = useCallback((uid, token, expirationDate) => {\r\n    setToken(token);\r\n    setUserId(uid);\r\n    const tokenExpirationDate = expirationDate || new Date(new Date().getTime() + 1000 * 60 * 60);\r\n    setTokenExpirationDate(tokenExpirationDate);\r\n    localStorage.setItem(\r\n      \"userData\",\r\n      JSON.stringify({\r\n        userId: uid,\r\n        token: token,\r\n        expiration: tokenExpirationDate.toISOString()\r\n      })\r\n    );\r\n  }, []);\r\n\r\n  const logout = useCallback(() => {\r\n    setToken(null);\r\n    setTokenExpirationDate(null);\r\n    setUserId(null);\r\n    localStorage.removeItem(\"userData\");\r\n    history.push(\"/\");\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const storedData = JSON.parse(localStorage.getItem(\"userData\"));\r\n    if ( storedData && storedData.token && new Date(storedData.expiration) > new Date() ) {\r\n      login(storedData.userId, storedData.token, new Date(storedData.expiration));\r\n    }\r\n  }, [login]);\r\n\r\n  useEffect(() => {\r\n    if (token && tokenExpirationDate) {\r\n      const remainingTime = tokenExpirationDate.getTime() - new Date().getTime();\r\n      logoutTimer = setTimeout(logout, remainingTime);\r\n    } else {\r\n      clearTimeout(logoutTimer);\r\n    }\r\n  }, [token, logout, tokenExpirationDate]);\r\n\r\n  let routes;\r\n  if (token) {\r\n    routes = (\r\n      <Switch>\r\n        <Route path=\"/\" exact component={HurleyMaker} />\r\n        <Route path=\"/orders/:uid\" component={YourOrders} />\r\n        <Route path=\"/place-order\" component={PlaceOrder} />\r\n        <Route path=\"/order-success\" component={OrderSuccess} />\r\n        <Route path=\"/users/:uid\" component={YourAccount} />\r\n        <Route path=\"/update-account\" component={AccountUpdate} />\r\n      </Switch>\r\n    );\r\n  } else {\r\n    routes = (\r\n      <Switch>\r\n        <Route path=\"/\" exact component={HurleyMaker} />\r\n        <Route path=\"/authenticate\" component={Authenticate} />\r\n      </Switch>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <AuthContext.Provider\r\n      value = {{\r\n        isLoggedIn: !!token,\r\n        token: token,\r\n        userId: userId,\r\n        login: login,\r\n        logout: logout\r\n      }}\r\n    >\r\n      <Container>\r\n        <Nav />\r\n        <Suspense fallback={<div><Loader active='true' /></div>}>\r\n            {routes}\r\n        </Suspense>\r\n      </Container>\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport default Layout;\r\n"]},"metadata":{},"sourceType":"module"}